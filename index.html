<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Visualizer</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- メニューバー -->
    <nav class="menubar" id="menubar">
        <div class="menu-item" data-menu="file">
            <span class="menu-title">File</span>
            <div class="submenu">
                <div class="submenu-item has-submenu" data-submenu="import">
                    <span>Import</span>
                    <span class="arrow">▶</span>
                    <div class="submenu submenu-right">
                        <div class="submenu-item" id="import-network">Network File</div>
                        <div class="submenu-item" id="import-table">Table File</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="menu-item" data-menu="layout">
            <span class="menu-title">Layout</span>
            <div class="submenu">
                <div class="submenu-item" id="layout-tools">Layout Tools...</div>
                <div class="submenu-item" id="edge-bends">Edge Bends...</div>
                <div class="submenu-item has-submenu" data-submenu="hierarchical">
                    <span>Hierarchical</span>
                    <span class="arrow">▶</span>
                    <div class="submenu submenu-right">
                        <div class="submenu-item" id="layout-dagre">Defaults</div>
                        <div class="submenu-item" id="layout-equal">Equal</div>
                        <div class="submenu-item" id="sort-nodes-az">Sort Nodes (A-Z)</div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- グラフ表示領域 -->
    <div id="cy-container">
        <div id="cy"></div>
    </div>

    <!-- カラムマッピングモーダル -->
    <div class="modal-overlay" id="column-mapping-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Column Mapping</h2>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="mapping-table-container">
                    <table class="mapping-table" id="mapping-table">
                        <thead>
                            <tr>
                                <th>Column Name</th>
                                <th>Role</th>
                                <th>Data Type</th>
                                <th>Delimiter</th>
                            </tr>
                        </thead>
                        <tbody id="mapping-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modal-cancel">Cancel</button>
                <button class="btn btn-primary" id="modal-import">Import</button>
            </div>
        </div>
    </div>

    <!-- プログレスオーバーレイ -->
    <div class="progress-overlay" id="progress-overlay">
        <div class="spinner"></div>
        <p class="progress-text">Loading...</p>
    </div>

    <!-- Layout Toolsパネル -->
    <div class="layout-tools-panel" id="layout-tools-panel">
        <div class="tools-panel-header">
            <h3>Layout Tools</h3>
        </div>
        <div class="tools-panel-body">
            <!-- Scale -->
            <div class="tools-section">
                <h4>Scale</h4>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="scale-axis" value="width" id="scale-width" checked>
                        Width
                    </label>
                    <label>
                        <input type="radio" name="scale-axis" value="height" id="scale-height">
                        Height
                    </label>
                    <label>
                        <input type="radio" name="scale-axis" value="selected" id="scale-selected">
                        Selected Only
                    </label>
                </div>
                <div class="slider-wrapper">
                    <div class="slider-ticks">
                        <span class="tick"></span>
                        <span class="tick"></span>
                        <span class="tick"></span>
                        <span class="tick"></span>
                        <span class="tick"></span>
                    </div>
                    <input type="range" id="scale-slider" min="-3" max="3" step="0.1" value="0" class="slider">
                </div>
                <div class="slider-labels">
                    <span>1/8x</span>
                    <span>1/4x</span>
                    <span>1x</span>
                    <span>4x</span>
                    <span>8x</span>
                </div>
                <div class="value-input-container">
                    <input type="number" id="scale-value-input" value="1.00" step="0.01" min="0.125" max="8" class="value-input">
                </div>
            </div>
            
            <!-- Rotate -->
            <div class="tools-section">
                <h4>Rotate</h4>
                <div class="slider-wrapper">
                    <div class="slider-ticks">
                        <span class="tick"></span>
                        <span class="tick"></span>
                        <span class="tick"></span>
                        <span class="tick"></span>
                        <span class="tick"></span>
                    </div>
                    <input type="range" id="rotate-slider" min="-180" max="180" step="1" value="0" class="slider">
                </div>
                <div class="slider-labels">
                    <span>-180°</span>
                    <span>-90°</span>
                    <span>0°</span>
                    <span>90°</span>
                    <span>180°</span>
                </div>
                <div class="value-input-container">
                    <input type="number" id="rotate-value-input" value="0" step="1" min="-180" max="180" class="value-input">
                </div>
            </div>
        </div>
    </div>

    <!-- Edge Bendsパネル -->
    <div class="edge-bends-panel" id="edge-bends-panel">
        <div class="tools-panel-header">
            <h3>Edge Bends</h3>
        </div>
        <div class="tools-panel-body">
            <!-- Bend Strength -->
            <div class="tools-section">
                <h4>Bend Strength</h4>
                <div class="slider-wrapper">
                    <div class="slider-ticks">
                        <span class="tick"></span>
                        <span class="tick"></span>
                        <span class="tick"></span>
                        <span class="tick"></span>
                        <span class="tick"></span>
                    </div>
                    <input type="range" id="bend-strength-slider" min="0" max="80" step="1" value="40" class="slider">
                </div>
                <div class="slider-labels">
                    <span>0</span>
                    <span>20</span>
                    <span>40</span>
                    <span>60</span>
                    <span>80</span>
                </div>
                <div class="value-input-container">
                    <input type="number" id="bend-strength-value" value="40" step="1" min="0" max="80" class="value-input">
                </div>
            </div>
        </div>
    </div>

    <!-- Sort Nodes (A-Z)パネル -->
    <div class="sort-nodes-panel" id="sort-nodes-panel">
        <div class="tools-panel-header">
            <h3>Sort Nodes (A-Z)</h3>
        </div>
        <div class="tools-panel-body">
            <div class="tools-section">
                <h4>Sort Direction</h4>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="sort-axis" value="x-axis" id="sort-x-axis" checked>
                        X-axis (Rows)
                    </label>
                    <label>
                        <input type="radio" name="sort-axis" value="y-axis" id="sort-y-axis">
                        Y-axis (Columns)
                    </label>
                </div>
                <button class="btn btn-primary" id="sort-apply-btn" style="width: 100%; margin-top: 15px;">Apply Sort</button>
            </div>
        </div>
    </div>

    <!-- 隠しファイル入力 -->
    <input type="file" id="file-input-network" accept=".xlsx,.xls" style="display: none;">
    <input type="file" id="file-input-table" accept=".xlsx,.xls" style="display: none;">

    <!-- 外部ライブラリ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dagre/0.8.5/dagre.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cytoscape-dagre@2.5.0/cytoscape-dagre.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- アプリケーションモジュール -->
    <script src="js/NetworkManager.js"></script>
    <script src="js/FileHandler.js"></script>
    <script src="js/LayoutManager.js"></script>
    <script src="js/LayoutTools.js"></script>
    <script src="js/EdgeBendsPanel.js"></script>
    <script src="js/SortNodesPanel.js"></script>
    <script src="js/ModalManager.js"></script>
    <script src="js/MenuManager.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
